syntax = "proto3";

option go_package = "main";

message Login {
    string username = 1;
}

message Contact {
    string name = 1;
    bool online = 2;
}

message Text {
    string body = 1;
}

message File {
    string key = 1;
    bytes data = 2;
}

message Time {
    int64 value = 1;
    int32 scale = 2;
    uint32 flags = 3;
    int64 epoch = 4;
}

message Timestamp {
    Time duration = 1;
    Time presentation = 2;
}

message Image {
    int64 width = 1;
    int64 height = 2;
    uint32 format = 3;
    map <string, string> attachments = 4;
    bytes data = 5;
}

message FormatDescription {
    uint32 mediaType = 1;
    uint32 mediaSubtype = 2;
    map <string, string> extensions = 3;
}

message VideoSample {
    Image image = 1;
}

message AudioSample {
    Image image = 1;
}

message Av {
    VideoSample video = 1;
    AudioSample audio = 2;
}

message AVSession {
    string id = 1;
    bool active = 2;
    bytes data = 3;
}

message Haber {

    uint32 version = 1;
    string sessionId = 2;
    string from = 3;
    string to = 4;

    // Identifies which field is filled in
    enum Which {
        LOGIN = 0;
        CONTACTS = 1;
        PRESENCE = 2;
        TEXT = 3;
        FILE = 4;
        AV = 5;
        AudioSession = 6;
        VideoSession = 7;
    }
    Which which = 7;

    // One of the following will be filled in
    Login login = 101;
    repeated Contact contacts = 102; // for roster, presence, and invite
    Text text = 104;
    Av av = 105;
    AVSession avSession = 106;
    File file = 107;
}
